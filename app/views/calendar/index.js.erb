console.log("test");

var e = [<% @schedule.each do |s| %> {
    title:  '<%=  s.sale.name unless s.sale.nil? %>' + '<%= if s.sale.nil? then s.user.email.split("@")[0].upcase unless s.user.nil? end %>' + " : " + '<%= s.company_name unless s.company_name.nil? %>'
                  + " : " + '<%= s.job_num unless s.job_num.nil? %>',
                  company: '<%= s.company_name unless s.company_name.nil? %>',
                  job_num: '<%= s.job_num unless s.job_num.nil? %>',
                  sales: '<%= s.sale.name unless s.sale.nil? %>' + '<%= if s.sale.nil? then s.user.email.split("@")[0].upcase unless s.user.nil? end %>',
                  project: '<%= s.project.rstrip().gsub("'"){"\\'"}.split.join(' ') unless s.project.nil? %>',
                  <% x = Array.new  %>
                  <% s.products.each do |i| %>
                    <% x.push(i.name)  %>
                   <% end %>
                  products: '<%= x.to_s %>',
    start: new Date(<%= s.date.strftime("%Y, %m - 1, %d, %H, %M") unless s.date.nil? %>),
                  allDay: <%= if s.all_day == 1 then true else false end %>,
                  color: <% if !(s.company.nil?) and !(s.company.newcom.nil?) %>
                       '<%= 'red' %>'
                       <% else %>
                       '<%= 'blue' %>'
                       <% end %>
    },
<% end %>];

 var holiday = [<% @holidays.each do |s| %>
        {
           title:  '<%=  s.name.upcase %>',
           start: new Date(<%= s.date.strftime("%Y, %m - 1, %d, %H, %M") unless s.date.nil? %>),
           allDay: true
         },
    <% end %>];

var moment = $('#calendar').fullCalendar('getDate');
console.log(moment.getMonth()+1);

$('#calendar').fullCalendar(  'removeEvents');
$('#calendar').fullCalendar(  'addEventSource', e);
$('#calendar').fullCalendar(  'addEventSource', holiday);
$('#calendar').fullCalendar(  'refetchEvents');
